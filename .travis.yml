language: php

cache:
  directories:
    - $HOME/.composer/cache

stages:
  - style
  - test

jobs:
  allow_failures:
    - php: nightly

  include:
    - stage: Style

      php: 7.3

      before_install:
        - phpenv config-rm xdebug.ini || true

      install:
        - composer install

      script:
        - vendor/bin/phpcs --standard=PSR2 src -n

    - &TEST_ON_PRECISE

      stage: Test

      php: 5.3

      dist: precise

      before_install:
        - phpenv config-rm xdebug.ini || true

      install:
        - composer install

      script:
        - vendor/bin/phpunit

    - <<: *TEST_ON_PRECISE

      php: 5.5

    - <<: *TEST_ON_PRECISE

      php: 5.6

    - &TEST

      stage: Test

      php: 7.0

      before_install:
        - phpenv config-rm xdebug.ini || true

      install:
        - composer install

      script:
        - vendor/bin/phpunit

    - <<: *TEST

      php: 7.1

    - <<: *TEST

      php: 7.2

    - <<: *TEST

      php: 7.3

    - <<: *TEST

      php: nightly
